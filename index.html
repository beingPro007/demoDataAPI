<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Supplier & Product Management</title>
    <style>
      /* Your existing CSS styles remain unchanged */
      body {
        font-family: Arial, sans-serif;
        background: #f4f6f8;
        margin: 0;
        padding: 0;
      }
      .container {
        max-width: 1200px;
        margin: 40px auto 20px auto;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
        padding: 2em;
      }
      h2,
      h3 {
        text-align: center;
        margin-bottom: 1em;
      }
      form label {
        display: block;
        margin-top: 1em;
        margin-bottom: 0.3em;
        color: #333;
      }
      form input,
      form select,
      form textarea {
        width: 100%;
        padding: 0.7em;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 1em;
        margin-bottom: 0.5em;
      }
      button[type="submit"],
      .action-btn {
        margin-top: 1em;
        background: #1976d2;
        color: #fff;
        border: none;
        padding: 0.7em 1.2em;
        border-radius: 4px;
        font-size: 1em;
        cursor: pointer;
        transition: background 0.2s;
      }
      button[type="submit"]:hover,
      .action-btn:hover {
        background: #1565c0;
      }
      .section {
        margin-top: 2em;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        background: #fafbfc;
        margin-bottom: 2em;
      }
      th,
      td {
        border: 1px solid #e0e0e0;
        padding: 0.6em 0.4em;
        text-align: center;
      }
      th {
        background: #e3eaf6;
        color: #333;
      }
      .empty-msg {
        text-align: center;
        color: #888;
        padding: 1em 0;
      }
      .products-table {
        margin: 0.5em 0 1em 0;
        background: #f8fafd;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>Supplier & Product Management</h2>

      <!-- Supplier Form -->
      <form id="supplierForm">
        <label for="supplier_id">Supplier ID:</label>
        <input
          type="text"
          id="supplier_id"
          name="supplier_id"
          required
          maxlength="12"
        />

        <label for="name">Name:</label>
        <input type="text" id="name" name="name" required />

        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required />

        <button type="submit">Add Supplier</button>
      </form>
      <div id="supplier-message"></div>

      <!-- Product Form -->
      <div class="section">
        <h3>Add Product</h3>
        <form id="productForm">
          <label for="sku">SKU:</label>
          <input type="text" id="sku" name="sku" required maxlength="10" />

          <label for="productName">Product Name:</label>
          <input type="text" id="productName" name="name" required />

          <label for="price">Price:</label>
          <input
            type="number"
            id="price"
            name="price"
            step="0.01"
            min="0"
            required
          />

          <label for="inventory">Inventory:</label>
          <input
            type="number"
            id="inventory"
            name="inventory"
            min="0"
            required
          />

          <label for="brandPhoneNumber">Brand Phone Number:</label>
          <input
            type="tel"
            id="brandPhoneNumber"
            name="brandPhoneNumber"
            required
            pattern="[\d+\-\s()]{7,20}"
          />

          <label for="owned_by">Supplier:</label>
          <select id="owned_by" name="owned_by" required>
            <option value="">Select Supplier</option>
          </select>

          <button type="submit">Add Product</button>
        </form>
        <div id="product-message"></div>
      </div>

      <!-- Product List -->
      <div class="section">
        <h3>All Products</h3>
        <div id="all-products"></div>
      </div>
    </div>

    <script>
      const PRODUCT_API = "http://localhost:3000/api/v1/product";
      const SUPPLIER_API = "http://localhost:3000/api/v1/supplier";

      // Populate supplier dropdown
      async function loadSuppliers() {
        const select = document.getElementById("owned_by");
        select.innerHTML = `<option value="">Select Supplier</option>`;
        try {
          const res = await fetch(`${SUPPLIER_API}/fetchAllSuppliers`);
          const data = await res.json();
          if (Array.isArray(data.suppliers)) {
            for (const supplier of data.suppliers) {
              select.innerHTML += `<option value="${supplier.id}">${supplier.supplier_id} - ${supplier.name}</option>`;
            }
          }
        } catch (err) {
          console.error("Error loading suppliers:", err);
        }
      }

      // Add Supplier
      document
        .getElementById("supplierForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();
          const supplier_id = document.getElementById("supplier_id").value;
          const name = document.getElementById("name").value;
          const email = document.getElementById("email").value;
          const messageDiv = document.getElementById("supplier-message");
          try {
            const res = await fetch(`${SUPPLIER_API}/addSupplier`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ supplier_id, name, email }),
            });
            const data = await res.json();
            if (res.ok) {
              messageDiv.style.color = "green";
              messageDiv.textContent = `Supplier added successfully!`;
              this.reset();
              loadSuppliers();
            } else {
              messageDiv.style.color = "red";
              messageDiv.textContent =
                data.message || "Failed to add supplier.";
            }
          } catch (err) {
            messageDiv.style.color = "red";
            messageDiv.textContent = `Error: ${err.message}`;
          }
        });

      // Add Product
      document
        .getElementById("productForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const sku = document.getElementById("sku").value.trim();
          const name = document.getElementById("productName").value.trim();
          const price = parseFloat(document.getElementById("price").value);
          const inventory = parseInt(
            document.getElementById("inventory").value
          );
          const brandPhoneNumber = document
            .getElementById("brandPhoneNumber")
            .value.trim();
          const owned_by = document.getElementById("owned_by").value;

          console.log("Name of the product", name);

          const messageDiv = document.getElementById("product-message");
          messageDiv.textContent = "";

          try {
            const response = await fetch(`${PRODUCT_API}/addProduct`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                sku,
                name,
                price,
                inventory,
                brandPhoneNumber,
                owned_by,
              }),
            });

            const data = await response.json();
            if (response.ok) {
              messageDiv.style.color = "green";
              messageDiv.textContent = `Product "${name}" added successfully!`;
              this.reset();
            } else {
              messageDiv.style.color = "red";
              messageDiv.textContent = data.message || "Error adding product.";
            }
          } catch (err) {
            messageDiv.style.color = "red";
            messageDiv.textContent = `Network error: ${err.message}`;
          }
        });
      // Fetch all products
      async function fetchAllProducts() {
        const div = document.getElementById("all-products");
        div.innerHTML = "Loading...";
        try {
          const res = await fetch(`${PRODUCT_API}/fetchAllProducts`);
          const data = await res.json();

          if (Array.isArray(data.products) && data.products.length > 0) {
            let html = `<table><thead>
        <tr>
          <th>SKU</th>
          <th>Name</th>
          <th>Price</th>
          <th>Inventory</th>
          <th>Brand Phone</th>
          <th>Supplier</th>
        </tr>
      </thead><tbody>`;

            for (const p of data.products) {
              console.log("product", p);

              html += `<tr>
          <td>${p.sku}</td>
          <td>${p.name}</td>
          <td>$${p.price.toFixed(2)}</td>
          <td>${p.inventory}</td>
          <td>${p.brandPhoneNumber || ""}</td>
          <td>${p.owned_by_supplier ? p.owned_by_supplier.supplier_id : "N/A"}</td>
        </tr>`;
            }

            html += `</tbody></table>`;
            div.innerHTML = html;
          } else {
            div.innerHTML = `<p class="empty-msg">No products found.</p>`;
          }
        } catch (err) {
          div.innerHTML = `<p style="color:red;">Error loading products: ${err.message}</p>`;
        }
      }

      // Initial load
      loadSuppliers();
      fetchAllProducts();
    </script>
  </body>
</html>
